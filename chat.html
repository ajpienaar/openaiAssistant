<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Bot</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-5">
    <div id="chatbox" class="bg-light p-3" style="height:400px; overflow-y:scroll;"></div>
    <textarea id="userInput" class="form-control mt-3" rows="3"></textarea>
    <button id="sendBtn" class="btn btn-primary mt-2">Send</button>
</div>

<script>
const socket = new WebSocket('ws://localhost:3000');

// Typewriter effect function
function typeWriter(text, element, speed = 50) {
    let i = 0;
    (function typing() {
        if (i < text.length) {
            element.innerHTML += text.charAt(i);
            i++;
            setTimeout(typing, speed);
        }
    })();
}

function addMessageToChat(sender, message) {
    const chatbox = document.getElementById('chatbox');
    let messageElement = document.createElement('div'); 
    let senderElement = document.createElement('strong');
    senderElement.textContent = `${sender}: `;
    messageElement.appendChild(senderElement);

    if (sender === 'Bot') {
        let messageContent = document.createElement('span');
        messageElement.appendChild(messageContent);
        typeWriter(message, messageContent);
    } else {
        let messageText = document.createTextNode(message);
        messageElement.appendChild(messageText);
    }

    chatbox.appendChild(messageElement);
    chatbox.scrollTop = chatbox.scrollHeight;
}

function sendMessage() {
    const inputField = document.getElementById('userInput');
    const message = inputField.value.trim();
    if (message) {
        socket.send(message);
        addMessageToChat('You', message);
        inputField.value = '';
    }
}

document.getElementById('sendBtn').addEventListener('click', sendMessage);

document.getElementById('userInput').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
        event.preventDefault(); 
        sendMessage();
    }
});

socket.onmessage = function(event) {
    try {
        if (event.data instanceof Blob) {
            const audioURL = URL.createObjectURL(event.data);
            const audio = new Audio(audioURL);
            audio.onloadeddata = () => audio.play();
        } else {
            const messageObj = JSON.parse(event.data);
            if (messageObj.type === 'text') {
                addMessageToChat('Bot', messageObj.data);
            }
        }
    } catch (e) {
        console.error('Error parsing message data:', e);
    }
};

socket.onerror = function(error) {
    console.error('WebSocket Error: ' + error);
};
</script>

</body>
</html>